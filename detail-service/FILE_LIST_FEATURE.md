# AuroraMag Detail Proxy - 文件列表功能

## 🎉 新增功能

已添加种子文件列表显示功能，在详情页显示种子包含的所有文件。

## 功能特性

### 1. 自动获取文件列表
- 通过 Bitmagnet GraphQL API 查询种子的文件信息
- 支持显示文件路径和大小
- 自动格式化文件大小（B, KB, MB, GB, TB）

### 2. 优雅的界面显示
- 📂 文件列表区域带滚动条
- 鼠标悬停高亮效果
- 响应式设计，适配各种屏幕
- 文件路径过长时显示省略号

### 3. API 支持
- JSON API: `/api/details/:infoHash`
- 返回字段:
  ```json
  {
    "files": [
      {
        "index": 0,
        "path": "folder/file.mkv",
        "size": 1234567890
      }
    ],
    "hasFilesInfo": true  // false 表示没有文件信息
  }
  ```

## 使用说明

### 访问详情页
1. 在 Prowlarr 搜索结果中点击任意条目
2. 跳转到详情页: `http://117.72.71.38:9696/details/{infoHash}`
3. 页面底部会显示文件列表（如果有）

### 三种显示状态

#### 1. 有文件列表
```
📂 文件列表 (5 个文件)
┌─────────────────────────────────────────────┐
│ video/movie.mkv              4.5 GB         │
│ subtitles/english.srt        45.2 KB        │
│ subtitles/chinese.srt        52.1 KB        │
│ sample.mkv                   125.3 MB       │
│ readme.txt                   1.2 KB         │
└─────────────────────────────────────────────┘
```

#### 2. 无文件信息
```
┌─────────────────────────────────────────────┐
│        📦 暂无文件列表信息                  │
└─────────────────────────────────────────────┘
```

#### 3. 加载中/不显示
如果 Bitmagnet 没有索引该种子的文件信息，该区域不显示。

## 技术实现

### GraphQL 查询
```graphql
query GetFiles($infoHash: Hash20!) {
  torrent {
    files(input: { infoHashes: [$infoHash] }) {
      totalCount
      items {
        index
        path
        size
      }
    }
  }
}
```

### 代码位置
- **文件**: `~/auroramag-detail-proxy/server.js`
- **函数**: `getTorrentDetails()` - 第 25-110 行
- **HTML模板**: 第 219-500 行

## 样式定制

文件列表的样式可以在 CSS 中修改：

```css
.files-section {
  /* 文件列表容器样式 */
  margin-top: 2rem;
  background: rgba(51, 65, 85, 0.3);
  border-radius: 0.5rem;
  padding: 1.5rem;
}

.file-item {
  /* 单个文件项样式 */
  display: flex;
  justify-content: space-between;
  padding: 0.75rem;
  background: rgba(30, 41, 59, 0.5);
}
```

## 常见问题

### Q: 为什么有些种子没有文件列表？
A: Bitmagnet 需要先爬取并索引种子的元数据。新种子或者未完全索引的种子可能没有文件信息。

### Q: 如何让更多种子显示文件列表？
A: 确保 Bitmagnet 的 DHT 爬虫正常运行，它会逐步索引更多种子的详细信息。

### Q: 文件列表太长怎么办？
A: 已设置最大高度为 400px，超出部分会显示滚动条。可以在 CSS 中修改 `.files-list` 的 `max-height`。

## 示例截图布局

```
┌─────────────────────────────────────────────────────────┐
│  [海报]  电影标题                                        │
│         ⭐ 8.5/10                                        │
│                                                          │
│         ┌────────┐ ┌────────┐ ┌────────┐               │
│         │文件大小│ │做种数  │ │分辨率  │               │
│         │ 4.5 GB │ │↑5 / ↓2│ │ 1080p  │               │
│         └────────┘ └────────┘ └────────┘               │
│                                                          │
│         🧲 下载磁力链接                                  │
├─────────────────────────────────────────────────────────┤
│  📂 文件列表 (3 个文件)                                 │
│  ┌───────────────────────────────────────────────┐     │
│  │ video/movie.part1.mkv        2.0 GB           │     │
│  │ video/movie.part2.mkv        2.5 GB           │     │
│  │ subtitles/chinese.srt        45.2 KB          │     │
│  └───────────────────────────────────────────────┘     │
└─────────────────────────────────────────────────────────┘
```

## 更新日志

### v1.1.0 (2025-11-13)
- ✨ 新增文件列表显示功能
- 🎨 优化详情页界面布局
- 📊 添加文件大小自动格式化
- 🔄 添加滚动条美化

### v1.0.0
- 基础详情页功能
- TMDB 元数据集成
- 公网地址自动配置

## 下一步计划

- [ ] 支持文件类型图标
- [ ] 支持按文件类型筛选
- [ ] 支持文件大小排序
- [ ] 支持搜索文件名
- [ ] 添加文件树形展示

## 贡献

欢迎提交 Issue 或 Pull Request！
